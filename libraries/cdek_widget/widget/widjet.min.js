function ipolWidjetController(e){var t={label:"iWidjet",params:{}};for(o in void 0===e&&(e={}),t)void 0===e[o]&&(e[o]=t[o]);var i=e.label,s=e.params;this.options={get:function(e){return a.get(e)},set:function(e,t){a.set(e,t)}},this.binders={add:function(e,t){r.addBind(e,t)},trigger:function(e,t){r.trigger(e,t)}},this.states={check:function(e){d.check(e)}},this.service={cloneObj:function(e){return n.cloneObj(e)},concatObj:function(e,t){return n.concatObj(e,t)},isEmpty:function(e){return n.isEmpty(e)},inArray:function(e,t){return n.inArray(e,t)},loadTag:function(e,t,i){n.loadTag(e,t,i)}},this.logger={warn:function(e){return c.warn(e)},error:function(e){return c.error(e)},log:function(e){return c.log(e)}};var o,c={warn:function(e){this.check("warn")&&console.warn(i+": ",e)},error:function(e){this.check("error")&&console.error(i+": ",e)},log:function(e){if(this.check("log"))if("object"==typeof e)for(var t in console.log(i+": "),e)console.log(t,e[t]);else console.log(i+": ",e)},check:function(e){var t=!1;switch(e){case"warn":t=a.check(!0,"showWarns");break;case"error":t=a.check(!0,"showErrors");break;case"log":t=a.check(!0,"showLogs")}return t&&a.check(!1,"hideMessages")}},n={cloneObj:function(e){var t=!1;if("object"!=typeof e)return t;if(1===arguments.length)for(var i in t={},e)t[i]=e[i];else for(var i in t=[],e)t.push(e[i]);return t},concatObj:function(e,t){if("object"==typeof e&&"object"==typeof t)for(var i in t)e[i]=t[i];return e},isEmpty:function(e){var t=!0;if("object"==typeof e)for(var i in e){t=!1;break}else t=e;return t},inArray:function(t,e){return e.filter(function(e){return e==t}).length},loadTag:function(e,t,i){var o=!1;void 0===t||"script"===t?((o=document.createElement("script")).src=e,o.type="text/javascript",o.language="javascript"):((o=document.createElement("link")).href=e,o.rel="stylesheet",o.type="text/css"),document.getElementsByTagName("head")[0].appendChild(o),void 0!==i&&(o.onload=i,o.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||o.onload()})}},a={self:this,options:{showWarns:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},showErrors:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},showLogs:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hideMessages:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"}},check:function(e,t,i){t=this.get(t);return null===t?null:void 0===i?e===t:e==t},get:function(e){return void 0!==this.options[e]?this.options[e].value:(c.warn('Undefined option "'+e+'"'),null)},set:function(e,t){var i;void 0===this.options[t]?c.warn("Undefined option to set : "+t):"function"!=typeof this.options[t].check||this.options[t].check.call(this.self,e)?this.options[t].value=e:(i=!(void 0===this.options[t].hint||!this.options[t].hint)&&": "+this.options[t].hint,c.warn("Incorrect setting value ("+e+") for option "+t+i))},iniSetter:function(e,t){for(var i in a.options)a.options[i].setting===t&&void 0!==e[i]&&a.set(e[i],i)}},r={events:{onStart:[]},trigger:function(e,t){if(void 0===this.events[e])c.error("Unknown event "+e);else if(0<this.events[e].length)for(var i in this.events[e])this.events[e][i](t)},iniSetter:function(e){for(var t in this.events)if(this.events.hasOwnProperty(t)&&void 0!==e[t])if("object"==typeof e[t])for(var i in e[t])this.addBind(e[t][i],t);else this.addBind(e[t],t)},addBind:function(e,t){"function"==typeof e?this.events[t].push(e):c.warn('The callback "'+e+'" for '+t+" is not a function")}},d={self:this,states:{start:{_start:!1}},check:function(e){var t,i=!1;for(t in this.states){for(var o in this.states[t])o===e&&(this.states[t][o]=!0,i=t);if(i)break}if(i){var n,r=!0;for(n in this.states[i])if(!this.states[i][n]){r=!1;break}r&&void 0!==l[i]&&(a.iniSetter(s,i),l[i].call(this.self,s))}else"started"===e?c.error("No callbacks for starting"):c.error("Unknown state of loading: "+e)}},l={start:function(e){r.iniSetter(e),r.trigger("onStart"),d.check("started")}},p={options:"object",states:"object",loaders:"funciton",stages:"object",events:"string"};for(o in p)if(void 0!==e[o])for(var g in e[o])if({}.hasOwnProperty.call(e[o],g))if(typeof e[o][g]!==p[o])c.error("Illegal "+o+' "'+g+'": '+e[o][g]);else switch(o){case"options":a.options[g]=n.cloneObj(e.options[g]);break;case"states":d.states[g]=n.cloneObj(e.states[g]);break;case"loaders":l[g]=e.loaders[g];break;case"events":r.events[e.events[g]]=[];break;case"stages":"object"!=typeof e.stages[g].states||"function"!=typeof e.stages[g].function?c.error('Illegal stage "'+g+'": '+e[o][g]):(d.states[g]=n.cloneObj(e.stages[g].states),l[g]=e.stages[g].function)}d.check("_start")}function ISDEKWidjet(e){var t;e.path||(t=(t=document.getElementById("ISDEKscript").src).substring(0,t.indexOf("widjet.js"))+"scripts/",e.path=t),e.servicepath||(e.servicepath=e.path+"service.php"),e.templatepath||(e.templatepath=e.path+"template.php"),e.currency||(e.currency="RUB");var n={onJSPCSSLoad:function(){l.states.check("JSPCSS")},onStylesLoad:function(){l.states.check("JSPCSS"),l.states.check("styles")},onIPJQLoad:function(){l.states.check("jquery")},onJSPJSLoad:function(){l.states.check("JSPJS")},onPVZLoad:function(){l.states.check("PVZ")},onDataLoad:function(){l.states.check("data")},onLANGLoad:function(){l.states.check("lang")},onYmapsLoad:function(){l.states.check("ymaps")},onYmapsReady:function(){l.states.check("mapsReady")},onYmapsInited:function(){l.states.check("mapsInited")},onCityFrom:function(){l.states.check("cityFrom")}},l=new ipolWidjetController({label:"ISDEKWidjet",options:{path:{value:e.path,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},servicepath:{value:e.servicepath,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},templatepath:{value:e.templatepath,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},country:{value:"all",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (countryname)"},lang:{value:"rus",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (laguage name)"},link:{value:e.link,check:function(e){return!1===e||0<ipjq("#"+e).length},setting:"afterJquery",hint:"No element whit this id to put the widjet"},defaultCity:{value:e.defaultCity,check:function(e){return!1!==this.city.check(e)},setting:"dataLoaded",hint:"Default City wasn't founded"},choose:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidedress:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidecash:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidedelt:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},popup:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},region:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},detailAddress:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},apikey:{value:"ea83aee9-5073-407d-8ebb-a9bc2770cd09",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (apikey)"},goods:{value:!1,check:function(e){if("object"!=typeof e)return!1;if(void 0!==e.width)return!1;for(var t in e)if(!(void 0!==e[t].length&&e[t].length&&void 0!==e[t].width&&e[t].width&&void 0!==e[t].height&&e[t].height&&void 0!==e[t].weight&&e[t].weight))return!1;return!0},setting:"start",hint:"Value must be an array of objects of type {length:(float),width:(float),height(float),weight(float)}"},cityFrom:{value:e.cityFrom,check:function(e){return!1!==this.city.check(e)},setting:"dataLoaded",hint:"City From wasn't founded"},currency:{value:e.currency,check:function(e){return-1!==["RUB","KZT","USD","EUR","GBP","CNY","BYN","UAH","KGS","AMD","TRY","THB","KRW","AED","UZS","MNT"].indexOf(e)},setting:"start",hint:"Currency wasn't founded"}},events:["onChoose","onChooseProfile","onChooseAddress","onReady","onCalculate"],stages:{mainInit:{states:{started:!1},function:function(){this.service.loadTag(this.options.get("path")+"ipjq.js","script",n.onIPJQLoad);var e="rus"==this.options.get("lang")?"ru_RU":"en_GB";this.service.loadTag("https://api-maps.yandex.ru/2.1/?apikey="+this.options.get("apikey")+"&lang="+e,"script",n.onYmapsLoad),this.service.loadTag(this.options.get("path")+"style.css","link",n.onStylesLoad)}},afterJquery:{states:{jquery:!1},function:function(){this.service.loadTag(this.options.get("path")+"jquery.mCustomScrollbar.concat.min.js","script",n.onJSPJSLoad),ipjq.getJSON(l.options.get("servicepath"),{isdek_action:"getPVZ",country:this.options.get("country"),lang:this.options.get("lang")},p.parsePVZFile),ipjq.getJSON(l.options.get("servicepath"),{isdek_action:"getLang",lang:this.options.get("lang")},o.write)}},ymapsBinder1:{states:{ymaps:!1},function:function(){ymaps.ready(n.onYmapsReady())}},ymapsBinder2:{states:{mapsReady:!1},function:function(){i()}},dataLoaded:{states:{JSPCSS:!1,JSPJS:!1,PVZ:!1,styles:!1,lang:!1},function:function(){n.onDataLoad(),l.options.get("cityFrom")?ipjq.getJSON(l.options.get("servicepath"),{isdek_action:"getCity",city:l.options.get("cityFrom")},function(e){void 0===e.error?c.cityFrom=e.id:l.logger.warn("City from was't found "+e.error),n.onCityFrom("onCityFrom")}):n.onCityFrom("onCityFrom")}},ready:{states:{data:!1,mapsInited:!1,cityFrom:!1},function:function(){"auto"!=l.options.get("defaultCity")&&p.city.set(l.options.get("defaultCity")),u.readyA=!0,u.html.loadCityList(p.city.collection),l.popupped?l.loadedToAction=!0:l.finalAction()}}},params:e});function i(){void 0===l.incrementer&&(l.incrementer=0),"function"!=typeof ymaps.geocode?50<l.incrementer++?l.logger.error("Unable to load ymaps"):window.setTimeout(i,500):n.onYmapsInited()}l.popupped=!1,l.loadedToAction=!1,l.finalActionCalled=!1,l.loaderHided=!1,l.finalAction=function(){!0!==l.finalActionCalled&&(l.finalActionCalled=!0,u.controller.loadCity(),this.sdekWidgetEvents(),this.binders.trigger("onReady"))},l.hideLoader=function(){l.loaderHided||(l.loaderHided=!0,ipjq(g.get("PRELOADER")).fadeOut(300),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search, .CDEK-widget__sidebar, .CDEK-widget__logo").removeClass("CDEK-widget__inaccessible"))};var r={blocks:{},getBlock:function(e,t){if(void 0===r.blocks[e])return"";if(_tmpBlock=r.blocks[e],"object"==typeof t)for(keyVal in t)_tmpBlock=_tmpBlock.replace(new RegExp("#"+keyVal+"#","g"),t[keyVal]);return _tmpBlock=g.replaceAll(o.replaceAll(_tmpBlock)),_tmpBlock},save:function(e){r.blocks=e,u.html.place()}},p={regions:{collection:{},cityes:{},map:{}},city:{indexOfSome:function(e,t){for(keyI in t)if(t[keyI]==e)return keyI;return!1},collection:{},collectionFull:{},current:!1,get:function(){return this.current},set:function(e,t=!1){return this.checkCity(e)?!(void 0===this.collection[e]&&!t&&!(e=this.indexOfSome(e,this.collection)))&&(this.current=e):(l.logger.error("Unknown city: "+e),!1)},checkCity:function(e){return void 0!==this.collection[e]||-1<this.indexOfSome(e,this.collection)},getName:function(e){return!!this.checkCity(e)&&(void 0===this.collection[e]&&(e=this.indexOfSome(e,this.collection)),this.collection[e])},getFullName:function(e){return!!this.checkCity(e)&&(void 0===this.collectionFull[e]&&(e=this.indexOfSome(e,this.collectionFull)),this.collectionFull[e])},getId:function(e){return!!this.checkCity(e)&&(void 0===this.collection[e]&&(e=this.indexOfSome(e,this.collection)),e)}},PVZ:{collection:{},bycoord:{},bycoordCur:0,check:function(e){return p.city.checkCity(e)&&void 0!==this.collection[e]},getCityPVZ:function(e){if(this.check(e))return this.collection[e];l.logger.error("No PVZ in city "+e)},getRegionPVZ:function(t){if(this.check(t)){let r={};var i=p.regions.cityes[t];let e=[];return e.push(...p.regions.map[i]),81===i&&e.push(...p.regions.map[9]),9===i&&e.push(...p.regions.map[81]),82===i&&e.push(...p.regions.map[26]),26===i&&e.push(...p.regions.map[82]),e.forEach((e,t,i)=>{var o,n=p.PVZ.collection[e];for(o in n)r[o]=n[o]}),r}l.logger.error("No PVZ in city "+t)},getCurrent:function(){return l.options.get("region")?this.getRegionPVZ(p.city.current):this.getCityPVZ(p.city.current)}},address:{current:!1,get:function(){return p.address.current},set:function(e){p.address.current=e},fill:function(e){p.address.set(e)}},parsePVZFile:function(e){if(void 0===e.pvz){var t="Unable to load list of PVZ : ";if(void 0===e.pvz){for(var i in e.error)t+=e.error[i]+", ";t=t.substr(0,t.length-2)}else t+="unknown error.";l.logger.error(t)}else{for(var o in void 0!==e.pvz.REGIONS&&(p.regions.collection=e.pvz.REGIONS,p.regions.cityes=e.pvz.CITYREG,p.regions.map=e.pvz.REGIONSMAP),e.pvz.PVZ)p.PVZ.collection[o]=e.pvz.PVZ[o],void 0!==e.pvz.CITY[o]&&void 0===p.city.collection[o]&&(p.city.collection[o]=e.pvz.CITY[o],p.city.collectionFull[o]=e.pvz.CITYFULL[o]);n.onPVZLoad()}}},c={bad:!1,profiles:{courier:{price:0,currency:"RUB",term:0,tarif:!1},pickup:{price:0,currency:"RUB",term:0,tarif:!1}},history:[],defaultGabs:{length:20,width:30,height:40,weight:1},cityFrom:!1,binder:{},calculate:function(e=!1){if(this.cityFrom){var t=this.history.findIndex(e=>e.code===parseInt(p.city.current)&&"courier"===e.type&&e.weight===a.getWeight()),i=this.history.findIndex(e=>e.code===parseInt(p.city.current)&&"pickup"===e.type&&e.weight===a.getWeight());if(-1!==t&&-1!==i){for(var o in this.profiles){var n="pickup"===o?i:t;-1!==n&&(this.profiles[o].price=this.history[n].price,this.profiles[o].term=this.history[n].term,this.profiles[o].tarif=this.history[n].tarif)}l.binders.trigger("onCalculate",{profiles:l.service.cloneObj(c.profiles),city:p.city.current,cityName:p.city.getName(p.city.current)})}else{var r,s=Date.now();for(r in this.binder[parseInt(p.city.current)]={},this.profiles)this.profiles[r].price=null,this.profiles[r].term=null,this.profiles[r].tarif=!1,this.request(r,s,e)}}else l.logger.warn("No city from given: calculation is impossible")},request:function(e,t,i=!1){var o={type:e};if(void 0!==a.get()[0]){var n,r=a.get();for(n in o.goods=[],r)o.goods.push(r[n])}else o.goods=[this.defaultGabs];o.cityFromId=this.cityFrom,o.cityToId=i?p.city.get():p.city.getId(p.city.current),o.currency=l.options.get("currency"),void 0!==t&&(o.timestamp=t),p.city.current&&ipjq.getJSON(l.options.get("servicepath"),{isdek_action:"calc",shipment:o},c.onCalc)},onCalc:function(e){if(void 0!==e.error){var t="",i=!(c.bad=!0);for(n in e.error)if("object"==typeof e.error[n])for(var o in e.error[n])t+=e.error[n][o].text+" ("+e.error[n][o].code+"), ",3===e.error[n][o].code&&(i=!0);else t+=e.error[n]+", ";i?(l.logger.warn("Troubles while calculating: "+t.substring(0,t.length-2)),void 0!==e.type&&(c.profiles[e.type].price=!1,c.profiles[e.type].term=!1,c.profiles[e.type].tarif=!1)):l.logger.error("Error while calculating: "+t.substring(0,t.length-2))}else c.bad=!1,c.profiles[e.type].price=e.result.price,c.profiles[e.type].currency=e.result.currency,c.profiles[e.type].term=e.result.deliveryPeriodMax===e.result.deliveryPeriodMin?e.result.deliveryPeriodMin:e.result.deliveryPeriodMin+"-"+e.result.deliveryPeriodMax,c.profiles[e.type].tarif=void 0!==e.result.tarif?e.result.tarif:e.result.tariffId,c.history.push({code:parseInt(p.city.current),weight:a.getWeight(),type:e.type,price:e.result.price,currency:e.result.currency,term:c.profiles[e.type].term,tarif:c.profiles[e.type].tarif});if(void 0!==e.type&&void 0!==c.binder[parseInt(p.city.current)]){for(var n in c.binder[parseInt(p.city.current)][e.type]=!0,c.profiles)if(void 0===c.binder[parseInt(p.city.current)][n])return!1;l.binders.trigger("onCalculate",{profiles:l.service.cloneObj(c.profiles),city:p.city.current,cityName:p.city.getName(p.city.current)})}}},a={collection:"object"==typeof l.options.get("goods")?l.options.get("goods"):[],add:function(e){"object"!=typeof e||void 0===e.length||void 0===e.width||void 0===e.height||void 0===e.weight?l.logger.error("Illegal item "+e):(this.collection.push({length:e.length,width:e.width,height:e.height,weight:e.weight}),l.calculate())},reset:function(){this.collection=[]},get:function(){return l.service.cloneObj(this.collection)},getWeight:function(){return this.collection.reduce((e,t)=>e+t.weight,0)}},o={collection:{},replaceAll:function(e){for(langKey in this.collection)e=e.replace(new RegExp("#"+langKey+"#","g"),this.collection[langKey]);return e},get:function(e){return void 0!==this.collection[e]?this.collection[e]:(l.logger.warn("No lang string with key "+e),"")},write:function(e){if(ipjq.getJSON(l.options.get("templatepath"),{},r.save),void 0===e.LANG){var t="Unable to load land-file : ";if(void 0!==e.error){for(var i in e.error)t+=e.error[i]+", ";t=t.substr(0,t.length-2)}else t+="unknown error.";l.logger.error(t)}else o.collection=l.service.cloneObj(e.LANG),n.onLANGLoad()}},g={WID:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<5;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}()+"_",options:{MAP:"SDEK_map",PRELOADER:"preloader"},replaceAll:function(e){for(optKey in this.options)e=e.replace(new RegExp("#"+optKey+"#","g"),this.WID+this.options[optKey].replace("#",""));return e.replace(new RegExp("#WID#","g"),this.WID)},get:function(e){return void 0!==this.options[e]?"#"+this.WID+this.options[e]:"#"+this.WID+e}},u={readyA:!1,html:{get:function(){return r.getBlock("widget",{CITY:l.options.get("defaultCity")})},makeADAPT:function(){var e;l.options.get("link")||((e=ipjq(g.get("cdek_widget_cnt")).outerHeight())<476||ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box, .mCustomScrollBox").css("max-height","auto"),e<ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__box").outerHeight()+56?ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").css("max-height",e-56+"px"):ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").css("max-height",ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__box").outerHeight()+"px"))},makeFULLSCREEN:function(){this.makeADAPT(),ipjq(window).resize(this.makeADAPT())},place:function(){var e=this.get();l.options.get("link")?ipjq("#"+l.options.get("link")).html(e):(l.options.get("popup")?(l.popupped=!0,e=r.getBlock("popup",{WIDGET:e})):((e=ipjq(e)).css("position","fixed"),e.css("top",0),e.css("left",0),e.css("z-index",1e3)),ipjq("body").append(e),this.makeFULLSCREEN()),l.options.get("choose")||ipjq(g.get("cdek_widget_cnt")).addClass("nochoose");var t,e=r.getBlock("sidebar");l.options.get("hidecash")&&((t=[]).push(e.slice(0,1476)),t.push(e.slice(2693)),e=t.join("")),l.options.get("hidedress")&&((t=[]).push(e.slice(0,l.options.get("hidecash")?1476:2693)),t.push(e.slice(e.indexOf("<hr>"))),e=t.join("")),l.options.get("hidedelt")&&ipjq(g.get("cdek_delivery_types")).hide(),ipjq(g.get("sidebar")).html(e),this.makeADAPT()},loadCityList:function(e){for(var t in _list=ipjq(g.get("city_list")),e)_block=r.getBlock("city",{CITYID:t,CITYNAME:e[t],CITY_DETAILS:void 0!==p.regions.collection[t]?p.regions.collection[t]:"&nbsp;"}),_list.prepend(_block)},updatePrices:function(e){if(ipjq(g.get("cdek_widget_cnt")).find(g.get("cdek_delivery_types")+" div.CDEK-widget__delivery-type__item").remove(),void 0===e||0==e.length)ipjq(g.get("cdek_widget_cnt")).find(g.get("cdek_delivery_type_title span.CDEK_choose")).hide(),ipjq(g.get("cdek_widget_cnt")).find(g.get("cdek_delivery_type_title span.CDEK_no-avail")).show(),ipjq(g.get("cdek_widget_cnt")).find(g.get("cdek_delivery_type_none")).show();else for(var t in ipjq(g.get("cdek_widget_cnt")).find(g.get("cdek_delivery_type_title span.CDEK_choose")).show(),ipjq(g.get("cdek_widget_cnt")).find(g.get("cdek_delivery_type_title span.CDEK_no-avail")).hide(),ipjq(g.get("cdek_widget_cnt")).find(g.get("cdek_delivery_type_none")).hide(),e)switch(t){case"courier":case"pickup":c.bad&&!1===e[t].price||(_tmpBlock=r.getBlock("d_"+t,{SUMM:null===e[t].price?o.get("COUNTING"):e[t].price,CURR:null===e[t].price?"":o.get(e[t].currency),TIME:null===e[t].term?"":e[t].term,DAY:null===e[t].term?"":o.get("DAY")}),ipjq(g.get("cdek_delivery_types")).append(_tmpBlock))}this.makeADAPT()},hideMap:function(){ipjq(g.get("MAP")).css("display","none"),ipjq(g.get("cdek_widget_cnt")).find("#SDEK_info").css("display","none")}},controller:{getCity:function(){return p.city.get()},loadCity:function(e){ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-details__back").click(),void 0!==e&&1==e||this.calculate(),this.updatePrices(),u.ymaps.init(p.city.current)},selectCity:function(e){"object"==typeof e&&(e=e.data.name),void 0!==e&&e||(e=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").not(".no-active").first().data("cityid")),p.city.set(e),u.controller.loadCity(),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(p.city.getName(e)),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").removeClass("focus").addClass("no-active").parent("ul").removeClass("open"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]")[0].blur(),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item").removeClass("active"),setTimeout(function(){ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")},1e3),u.ui.addressSearch.ifOn()&&u.ui.addressSearch.hide()},putCity:function(e){"object"==typeof e&&(e=e.data.name),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(p.city.getName(e)),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").removeClass("focus").addClass("no-active").parent("ul").removeClass("open")},updatePrices:function(){u.html.updatePrices({courier:c.profiles.courier,pickup:c.profiles.pickup})},calculate:function(e=!1){c.calculate(e)},chooseDeliveryType:function(){if(u.ui.addressSearch.ifOn()&&u.ui.addressSearch.hide(),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").hasClass("open")){var e=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").find("li.focus");return 0!=e.length?u.controller.selectCity(e.find(".CDEK-widget__search-list__city-name").text()):u.controller.selectCity(),void setTimeout(function(){ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")},1e3)}ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")},choosePVZ:function(e){var t=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item:last");t.hasClass("active")||(t.attr("class","CDEK-widget__delivery-type__item").addClass("active"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item:first").attr("class","CDEK-widget__delivery-type__item").removeClass("active"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button").addClass("CDEK-widget__delivery-type__button_pvz"));t=p.PVZ.getCurrent();l.binders.trigger("onChoose",{id:e,PVZ:t[e],price:c.profiles.pickup.price,currency:c.profiles.pickup.currency,term:c.profiles.pickup.term,tarif:c.profiles.pickup.tarif,city:p.city.current,cityName:p.city.getName(p.city.current)}),l.options.get("link")||this.close()},chooseCOURIER:function(){l.binders.trigger("onChooseProfile",{id:"courier",city:p.city.current,cityName:p.city.getName(p.city.current),price:c.profiles.courier.price,currency:c.profiles.courier.currency,term:c.profiles.courier.term,tarif:c.profiles.courier.tarif}),u.ui.addressSearch.ifOn()||l.options.get("link")?u.ui.addressSearch.ifOn()&&(u.ui.addressSearch.show(),u.ui.addressSearch.fill()):this.close()},open:function(){l.options.get("link")?l.logger.error("This widjet is in non-floating mode - link is set"):u.ui.open()},close:function(){l.options.get("link")?l.logger.error("This widjet is in non-floating mode - link is set"):u.ui.close()}},ui:{currentmark:!1,markChozenPVZ:function(e){u.ymaps.selectMark(e.data.id)},choosePVZ:function(e){u.controller.choosePVZ(e.data.id)},addressSearch:{active:!1,getInput:function(){return ipjq(g.get("cdek_courier_address_place"))},ifOn:function(){return l.options.get("detailAddress")},show:function(){u.ui.addressSearch.active=!0,ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__box").removeClass("CDEK-widget__courier-address__box_close")},hide:function(){u.ui.addressSearch.active=!1,u.ui.addressSearch.killBaloon(),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__box").addClass("CDEK-widget__courier-address__box_close")},fill:function(){p.city.getName()&&u.ui.addressSearch.getInput().val(p.city.getName(u.controller.getCity())+", "),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__button").addClass("allowed")},mapClick:function(e){u.ui.addressSearch.active&&void 0!==e&&(u.ymaps.centerAddr(e.geometry.getCoordinates()),u.ui.addressSearch.getInput().val(e.properties.get("text")),u.ui.addressSearch.makeBaloon(e.geometry.getCoordinates(),e.properties.get("text")))},search:function(){u.ymaps.getSearchAddress(u.ui.addressSearch.getInput().val(),u.ui.addressSearch.found)},found:function(e){u.ui.addressSearch.killBaloon(),u.ymaps.centerAddr(e.coords),u.ui.addressSearch.makeBaloon(e.coords,e.name)},baloon:!1,makeBaloon:function(e,t){u.ui.addressSearch.baloon=u.ymaps.makeBaloon(e,"<div class='CDEK-widget__baloon'>"+t+'<br><button class="CDEK-widget__choose" type="button" data-label="'+o.get("L_CHOOSE")+'">'+o.get("L_CHOOSE")+"</button></div>"),u.ui.addressSearch.baloon&&(u.ui.addressSearch.baloon.balloon.open(),window.setTimeout(function(){ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__baloon .CDEK-widget__choose").on("click",u.ui.addressSearch.clickBaloon)},500))},killBaloon:function(){u.ui.addressSearch.baloon&&u.ymaps.killBaloon(u.ui.addressSearch.baloon)},clickBaloon:function(){u.ui.addressSearch.killBaloon(),u.ui.addressSearch.choose()},choose:function(){p.address.fill(u.ui.addressSearch.getInput().val()),ipjq.getJSON(l.options.get("servicepath"),{isdek_action:"getCity",address:p.address.get()},function(e){void 0===e.error?p.city.get()==e.city.id?(u.ui.addressSearch.hide(),l.binders.trigger("onChooseAddress",{id:"courier",city:p.city.current,cityName:p.city.getName(p.city.current),price:c.profiles.courier.price,currency:c.profiles.courier.currency,term:c.profiles.courier.term,tarif:c.profiles.courier.tarif,address:p.address.get()}),l.options.get("link")||this.close()):(p.city.set(e.city.id,!0),ipjq(g.get("cdek_search_input")).val(e.city.city),u.html.updatePrices({courier:{price:null,term:null},pickup:{price:null,term:null}}),alert(o.get("ADDRESS_ANOTHER")),u.controller.calculate(!0),u.controller.chooseDeliveryType()):(alert(o.get("ADDRESS_WRONG")),l.logger.warn("City from was't found "+e.error))})}},open:function(){ipjq(g.get("CDEK_popup")).show(),l.loadedToAction?l.finalAction():l.popupped=!1,!1!==u.ymaps.map&&u.ymaps.map.container.fitToViewport(),this.active=!0,10<=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box li").length&&ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar()},close:function(){this.active=!1,ipjq(g.get("CDEK_popup")).hide()}},ymaps:{map:!1,readyToBlink:!1,linker:g.get("MAP").replace("#",""),init:function(a){this.readyToBlink=!1;var d=this;0==a?ymaps.geolocation.get({}).then(function(e){for(var t=e.geoObjects.get(0).properties.get("metaDataProperty").GeocoderMetaData.Address.Components,i=t.length-1;0<=i&&("locality"!=t[i].kind||(a=(a=t[i].name).replace(/город\s|поселок\sгородского\sтипа\s|поселок\s|посёлок\s|деревня\s|село\s/gi,""),p.city.set(a),!1===p.city.current));i--);if(0==p.city.current){t=e.geoObjects.get(0).geometry._coordinates;var o,n=100;for(o in p.PVZ.collection)for(var r in p.PVZ.collection[o]){var s=p.PVZ.collection[o][r],c=Math.sqrt(Math.pow(s.cY-t[0],2)+Math.pow(s.cX-t[1],2));c<n&&(n=c,a=o)}a=0!=a?(p.city.set(a),p.city.getName(a)):(p.city.set("Москва"),"Москва")}l.options.set(a,"defaultCity"),u.controller.calculate(),u.controller.updatePrices(),d.loadMap(p.city.current),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(a)}):d.loadMap(p.city.current)},loadMap:function(e){var t=this;e=p.city.getFullName(e);let i={};ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").length&&ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").each(function(){i[ipjq(this).data("mtype")]=!0}),"object"!=typeof p.PVZ.getCurrent()?ymaps.geocode(e,{results:1}).then(function(e){e=e.geoObjects.get(0).geometry.getCoordinates();t.map?(t.map.setCenter(e),t.map.setZoom(10)):t.makeMap({center:e}),t.placeMarks(i)}):t.placeMarks(i)},makeMap:function(e){"object"!=typeof e&&(e={}),u.ymaps.map=new ymaps.Map(u.ymaps.linker,l.service.concatObj({zoom:10,controls:[]},e)),this.map.controls.add(new ymaps.control.ZoomControl,{float:"none",position:{left:12,bottom:70}}),u.ymaps.map.events.add("boundschange",l.hideLoader),u.ymaps.map.events.add("actionend",l.hideLoader),l.options.get("detailAddress")&&(u.ymaps.map.events.add("click",u.ymaps.getClickAddress),new ymaps.SuggestView(g.get("cdek_courier_address_place").substr(1)))},centerAddr:function(e){this.map.setCenter(e),this.map.setZoom(17)},clearMarks:function(){this.map.geoObjects.removeAll;do{var t=this.map;t.geoObjects.each(function(e){t.geoObjects.remove(e)})}while(t.geoObjects.getBounds())},placeMarks:function(e){let t=p.PVZ.getCurrent();if("object"!=typeof t?ipjq(g.get("sidebar")).hide():ipjq(g.get("sidebar")).show(),ipjq(g.get("panel")).find(g.get("pointlist")).html(""),ipjq(g.get("panel")).find(g.get("pointlist")).html(r.getBlock("panel_list")),_panelContent=ipjq(g.get("pointlist")).find(".CDEK-widget__panel-content"),"object"==typeof t){for(var i in u.ymaps.clusterer=new ymaps.Clusterer({gridSize:50,preset:"islands#ClusterIcons",clusterIconColor:"#0a8c37",hasBalloon:!1,groupByCoordinates:!1,clusterDisableClickZoom:!1,maxZoom:11,zoomMargin:[45],clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1}),geoMarks=[],t){if(void 0!==e){if(void 0!==e.dress&&1!=t[i].Dressing)continue;if(void 0!==e.cash&&1!=t[i].Cash)continue;if(void 0!==e.postamat&&1!=t[i].Postamat)continue}var o=l.options.get("path")+"images/sdekNActive.png",n=l.options.get("path")+"images/sdekActive.png";t[i].placeMark=new ymaps.Placemark([t[i].cY,t[i].cX],{},{iconLayout:"default#image",iconImageHref:o,iconImageSize:[40,43],iconImageOffset:[-10,-31]}),geoMarks.push(t[i].placeMark),t[i].placeMark.link=i,t[i].list_block=ipjq(r.getBlock("point",{P_NAME:t[i].Name,P_ADDR:t[i].Address,P_TIME:t[i].WorkTime.replace(new RegExp(",","g"),"<br/>")})),t[i].placeMark.listItem=t[i].list_block,t[i].placeMark.events.add(["balloonopen","click"],function(e){if(_prevMark=u.ui.currentmark,u.ui.currentmark=e.get("target"),"object"==typeof _prevMark)try{_prevMark.events.fire("mouseleave")}catch(e){}ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-burger:not(.active)").trigger("click"),u.ui.markChozenPVZ({data:{id:e.get("target").link,link:u.ui}})}),t[i].placeMark.events.add(["mouseenter"],function(e){ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-content").mCustomScrollbar("scrollTo",e.get("target").listItem),e.get("target").listItem.addClass("CDEK-widget__panel-list__item_active"),e.get("target").options.set({iconImageHref:n})}),t[i].placeMark.events.add(["mouseleave"],function(e){u.ui.currentmark!=e.get("target")&&(e.get("target").listItem.removeClass("CDEK-widget__panel-list__item_active"),e.get("target").options.set({iconImageHref:o}))}),t[i].list_block.mark=t[i].placeMark,t[i].list_block.on("click",{mark:i},function(e){t[e.data.mark].placeMark.events.fire("click")}).on("mouseenter",{id:i,ifOn:!0,link:u.ymaps},u.ymaps.blinkPVZ).on("mouseleave",{id:i,ifOn:!1,link:u.ymaps},u.ymaps.blinkPVZ),_panelContent.append(t[i].list_block)}0<geoMarks.length?(u.ymaps.clusterer.add(geoMarks),_bounds=u.ymaps.clusterer.getBounds(),this.map?_bounds[0][0]==_bounds[1][0]?(this.map.setCenter(_bounds[0]),this.map.setZoom(10),u.ymaps.clearMarks(),this.map.geoObjects.add(u.ymaps.clusterer)):this.map.setBounds(u.ymaps.clusterer.getBounds(),{zoomMargin:45,checkZoomRange:!0,duration:500}).then(function(){u.ymaps.clearMarks(),this.map.geoObjects.add(u.ymaps.clusterer),12<this.map.getZoom()&&this.map.setZoom(12)},function(){u.ymaps.clearMarks(),this.map.geoObjects.add(u.ymaps.clusterer),12<this.map.getZoom()&&this.map.setZoom(12)},this):(_bounds[0][0]==_bounds[1][0]?this.makeMap({center:_bounds[0]}):(this.makeMap({bounds:_bounds}),this.map.setBounds(_bounds,{zoomMargin:45,checkZoomRange:!0,duration:500})),u.ymaps.clearMarks(),this.map.geoObjects.add(u.ymaps.clusterer),l.hideLoader())):(u.ymaps.clearMarks(),l.hideLoader())}ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-content").mCustomScrollbar(),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").mCustomScrollbar(),10<=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box li").length&&ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar(),this.readyToBlink=!0},makeUpCenter:function(e){var t=this.map.options.get("projection");return e=this.map.converter.globalToPage(t.toGlobalPixels(e,this.map.getZoom())),ww=ipjq(g.get("panel")).width(),100<ipjq(g.get("cdek_widget_cnt")).width()-ww&&(e[0]=e[0]+ww/2),e=t.fromGlobalPixels(this.map.converter.pageToGlobal(e),this.map.getZoom())},selectMark:function(e){var t=p.PVZ.getCurrent();if(parseInt(p.city.current)!==parseInt(t[e].CityCode)&&(p.city.set(parseInt(t[e].CityCode)),city=p.city.getName(t[e].CityCode),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(city),c.calculate(),u.controller.updatePrices()),this.map.setCenter(u.ymaps.makeUpCenter([t[e].cY,t[e].cX])),_detailPanel=ipjq(g.get("panel")).find(g.get("detail_panel")),_detailPanel.html(""),_photoHTML="",void 0!==t[e].Picture)for(_imgIndex in t[e].Picture)_photoHTML+=r.getBlock("image_c",{D_PHOTO:t[e].Picture[_imgIndex]});_block=ipjq(r.getBlock("panel_details",paramsD={D_NAME:t[e].Name,D_ADDR:t[e].Address,D_TIME:t[e].WorkTime.replace(new RegExp(",","g"),"<br/>"),D_WAY:-1==t[e].AddressComment.search("http")?t[e].AddressComment:"",D_IMGS:_photoHTML})),""==paramsD.D_WAY&&_block.find(".CDEK-widget__way").remove(),""==paramsD.D_IMGS&&_block.find(".sdek_image_block").remove(),_block.find(g.get("choose_button")).on("click",{id:e},function(e){u.controller.choosePVZ(e.data.id)}),_detailPanel.html(_block),_detailPanel.find(".CDEK-widget__panel-content").mCustomScrollbar(),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list").css("left","-330px"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-details").css("right","0px")},blinkPVZ:function(e){var t;e.data.link.readyToBlink&&(t=p.PVZ.getCurrent(),u.ui.currentmark!=t[e.data.id].placeMark&&(e.data.ifOn?(e.data.link.clusterer.remove(t[e.data.id].placeMark),e.data.link.map.geoObjects.add(t[e.data.id].placeMark),t[e.data.id].placeMark.options.set({iconImageHref:l.options.get("path")+"images/sdekActive.png"})):(t[e.data.id].placeMark.options.set({iconImageHref:l.options.get("path")+"images/sdekNActive.png"}),e.data.link.map.geoObjects.remove(t[e.data.id].placeMark),e.data.link.clusterer.add(t[e.data.id].placeMark))))},getClickAddress:function(e){ymaps.geocode(e.get("coords"),{kind:"house"}).then(function(e){u.ui.addressSearch.mapClick(e.geoObjects.get(0))})},getSearchAddress:function(e,t){ymaps.geocode(e,{kind:"house"}).then(function(e){e=e.geoObjects.get(0),e={name:e.properties.get("name"),descr:e.properties.get("description"),coords:e.geometry.getCoordinates()};return void 0!==t&&t(e),e})},makeBaloon:function(e,t){t=new ymaps.Placemark(e,{balloonContent:t},{balloonCloseButton:!1,iconLayout:"default#image"});return u.ymaps.map.geoObjects.add(t),t},killBaloon:function(e){u.ymaps.map.geoObjects.remove(e)}}};return l.binders.add(u.controller.updatePrices,"onCalculate"),l.sdekSetPVZS=function(e){u.ymaps.clearMarks(),void 0===e?u.ymaps.placeMarks():u.ymaps.placeMarks(e)},l.chooseCourier=function(){u.controller.chooseCOURIER()},l.sdekWidgetEvents=function(){ipjq(".CDEK-widget__popup__close-btn").off("click").on("click",function(){ipjq(this).closest(".CDEK-widget__popup-mask").hide()}),ipjq(g.get("cdek_widget_cnt")).on("click",".CDEK-widget__sidebar-button",{widjet:l},function(){_this=ipjq(this),_this.toggleClass("active");var e,t=_this.attr("data-hint"),i=ipjq(g.get("cdek_widget_cnt")).find(t).outerWidth();_this.hasClass("CDEK-widget__sidebar-button-point")?ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").length?(e={},ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").each(function(){e[ipjq(this).data("mtype")]=!0}),l.sdekSetPVZS(e)):l.sdekSetPVZS():(ipjq(g.get("cdek_widget_cnt")).find(t).css({right:-i,opacity:"0"}),_this.hasClass("CDEK-widget__sidebar-burger")&&(_this.hasClass("close")&&_this.removeClass("close"),_this.toggleClass("open"),_this.hasClass("open")||_this.addClass("close"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")?_this.hasClass("active")?(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeOut(600),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeIn(600),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button_phone").removeClass("active")):(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeOut(600),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel").removeClass("open")):(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel").addClass("open"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeIn(600))),_this.hasClass("CDEK-widget__sidebar-button_phone")&&(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")?_this.hasClass("active")?(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeOut(600),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeIn(600),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-burger").removeClass("active").removeClass("open").addClass("close")):(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeOut(600),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel").removeClass("open")):(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel").addClass("open"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeIn(600))))}).on("click",".CDEK-widget__choose",function(){ipjq(this).addClass("widget__loading")}),ipjq(g.get("cdek_widget_cnt")).on("mousemove",".CDEK-widget__sidebar-button",function(){var e;ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")||(e=ipjq(this).attr("data-hint"),ipjq(g.get("cdek_widget_cnt")).find(e).css({right:"67px",opacity:"1"}))}).on("mouseleave",".CDEK-widget__sidebar-button",function(){var e=ipjq(this).attr("data-hint"),t=ipjq(g.get("cdek_widget_cnt")).find(e).outerWidth();ipjq(g.get("cdek_widget_cnt")).find(e).css({right:-t,opacity:"0"})}).on("hover",".CDEK-widget__panel-headline",function(){ipjq(this).outerWidth()<=ipjq(this).find("span").outerWidth()&&ipjq(this).addClass("hover-long")},function(){ipjq(this).hasClass("hover-long")&&ipjq(this).removeClass("hover-long")}),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button").each(function(e,t){var i=ipjq(t).attr("data-hint"),t=(ipjq(t).outerHeight()+-ipjq(g.get("cdek_widget_cnt")).find(i).outerHeight())/2+62*e,e=ipjq(g.get("cdek_widget_cnt")).find(i).outerWidth();ipjq(g.get("cdek_widget_cnt")).find(i).css({right:-e,top:t,opacity:"0"})}),ipjq(g.get("cdek_widget_cnt")).on("click",".CDEK-widget__panel-details__back",function(){ipjq(this).parents(".CDEK-widget__panel-details").css("right","-330px"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list").css("left","0px")}).on("click",".CDEK-widget__panel-details__block-img",function(){var e=ipjq(this).find("img").attr("src"),t=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__photo");t.find("img").attr("src",e),t.addClass("active")}).on("click",".CDEK-widget__photo",function(e){ipjq(e.target).is("img")||ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__photo").removeClass("active")}).on("focusin",".CDEK-widget__search-box input[type=text]",function(){ipjq(this).val(""),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").hasClass("CDEK-widget__delivery-type_close")?ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").addClass("open").find("li").removeClass("no-active"):(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").addClass("CDEK-widget__delivery-type_close"),setTimeout(function(){ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").addClass("open").find("li").removeClass("no-active")},1e3))}).on("click",".CDEK-widget__search-list ul li",function(){u.controller.selectCity(ipjq(this).data("cityid"))}).on("keydown",".CDEK-widget__search-box input[type=text]",function(e){var t=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li:not(.no-active)"),i=t.filter(".focus");40===e.keyCode&&(0==i.length?(t.first().addClass("focus"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",t.first(),{scrollInertia:300})):(i.removeClass("focus"),0!=i.nextAll().filter(":not(.no-active)").eq(0).length?(i.nextAll().filter(":not(.no-active)").eq(0).addClass("focus"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",i.next(t),{scrollInertia:300})):(t.first().addClass("focus"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",t.first(),{scrollInertia:300})))),38===e.keyCode&&(0==i.length?(t.last().addClass("focus"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",t.last(),{scrollInertia:300})):(i.removeClass("focus"),0!=i.prevAll().filter(":not(.no-active)").eq(0).length?(i.prevAll().filter(":not(.no-active)").eq(0).addClass("focus"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",i.prev(t),{scrollInertia:300})):(t.last().addClass("focus"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",t.last(),{scrollInertia:300}))))}).on("keyup",".CDEK-widget__search-box input[type=text]",function(e){try{var t=new RegExp("^("+ipjq(this).val()+")+.*","i")}catch(e){t=""}var i=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li");13!==e.keyCode?""!=t?($matches=i.filter(function(){return t.test(ipjq(this).find(".CDEK-widget__search-list__city-name").text().replace(/[^\wа-яё\s-]+/gi,""))}),i.not($matches).addClass("no-active").removeClass("focus"),0==$matches.length?i.parent("ul").removeClass("open"):i.parent("ul").hasClass("open")||i.parent("ul").addClass("open"),$matches.each(function(e,t){ipjq(t).hasClass("no-active")&&ipjq(t).removeClass("no-active")})):i.removeClass("no-active"):0==(i=i.not(".no-active").filter(".focus")).length?u.controller.selectCity():(u.controller.selectCity(i.find(".CDEK-widget__search-list__city-name").text()),i.removeClass("focus"))}).on("click",function(e){0==ipjq(e.target).closest(".CDEK-widget__search").length&&0!=ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").not(".no-active").length&&u.controller.putCity(u.controller.getCity())}).on("click",".CDEK-widget__delivery-type__item",{widjet:l},function(e){var t=ipjq(this).attr("data-delivery-type");ipjq(this).hasClass("active")||(ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item.active").removeClass("active"),ipjq(this).addClass("active"),ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button").addClass("CDEK-widget__delivery-type__button_"+t)),"courier"==t&&e.data.widjet.chooseCourier(),ipjq(this).parents(".CDEK-widget__delivery-type").addClass("CDEK-widget__delivery-type_close")}).on("click",".CDEK-widget__delivery-type__button",function(){u.controller.chooseDeliveryType()}).on("click",".CDEK-widget__courier-address__button",function(){u.ui.addressSearch.search()})},l.city={get:function(){return p.city.current},set:function(e){e=p.city.set(e);!1!==e&&ipjq(g.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(p.city.getName(e)),u.controller.loadCity()},check:function(e){return p.city.getId(e)}},l.PVZ={get:function(e){return p.PVZ.getCityPVZ(e)},check:function(e){return p.PVZ.check(e)}},l.cargo={add:function(e){a.add(e)},reset:function(){a.reset()},get:function(){return a.get()}},l.calculate=function(){return c.calculate(),c.profiles},l.options.get("link")||(l.open=function(){u.controller.open()},l.close=function(){u.controller.close()}),l}
